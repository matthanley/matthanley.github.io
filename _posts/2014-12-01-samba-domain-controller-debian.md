---

layout:			default
title:  		Active Directory DC on Debian / Samba 4
type:			post
navigation: 	false

date:   		2014-12-01
excerpt: 		Cheat sheet guide to provisioning an Active Directory Domain Controller with Samba 4 on Debian
gradient: 		3
image: 			header-4.jpg
details:		false

author: 		Matt Hanley
bio: 			"Yup, <i>that</i> guy."
twitter: 		"https://twitter.com/_matthanley"

---

## Preparation

### Configure Networking

_/etc/network/interfaces_

	auto lo
	iface lo inet loopback

	allow-hotplug eth0
	iface eth0 inet static
		address 192.168.1.20
		netmask 255.255.255.0
		gateway 192.168.1.1

	dns-nameservers 8.8.8.8
	dns-search domain.local

_/etc/hostname_

	dc1

_/etc/hosts_

	127.0.0.1 localhost
	127.0.1.1 dc1.domain.local dc1

### Configure Testing Repos

Samba 4 is only available in the Testing repos for Debian.

_/etc/apt/sources.list_

	deb http://ftp.uk.debian.org/debian/ testing main
	deb-src http://ftp.uk.debian.org/debian/ testing main
	deb http://security.debian.org/ testing/updates main
	deb-src http://security.debian.org/ testing/updates main

### Update & Install Prerequisites

	apt-get update
	apt-get dist-upgrade
	apt-get install ntp samba smbclient

### NTP

	update-rc.d ntp defaults

### Config Files

`smb.conf` is generated by samba-tool in the next step.

	rm /etc/samba/smb.conf

### Reboot

	reboot

## Provision Domain

### Samba Configuration

	samba-tool domain provision --use-rfc2307 --interactive
	ln -s /var/lib/samba/private/krb5.conf /etc/

### Fix Networking

Remove the external DNS server:

_/etc/network/interfaces_

	auto lo
	iface lo inet loopback

	allow-hotplug eth0
	iface eth0 inet static
		address 192.168.1.20
		netmask 255.255.255.0
		gateway 192.168.1.1

	dns-nameservers 192.168.1.20
	dns-search domain.local

### Reboot

	reboot
